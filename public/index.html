<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZyG - Discord VC Attendance Live</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background:#0d1117;
  color:#e6edf3;
  margin:0;
  padding:0;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1 { color:#238636; margin:20px 0; text-align:center; word-break:break-word; flex:1; }
header { width:100%; display:flex; justify-content:center; align-items:center; padding:10px 20px; box-sizing:border-box; position:relative; }
.admin-controls { display:flex; align-items:center; gap:10px; position:absolute; right:20px; top:50%; transform:translateY(-50%); }
.admin-controls input, .admin-controls button { padding:6px 10px; border-radius:6px; border:none; font-size:0.9em; }
.admin-controls input { border:1px solid #30363d; background:#0d1117; color:#e6edf3; }

.container { display:flex; gap:20px; width:95%; box-sizing:border-box; align-items:flex-start; }
#mainPanel { flex:2; min-width:400px; }
.rightColumn { flex:1; display:flex; flex-direction:column; gap:10px; min-width:300px; }

.panel { background:#161b22; border:1px solid #30363d; border-radius:12px; padding:20px; box-sizing:border-box; }
table { width:100%; border-collapse:collapse; }
th,td { border-bottom:1px solid #30363d; padding:6px 10px; text-align:left; }
th { color:#238636; }
.joined { color:#2ea043; }
.left { color:#da3633; }
#history { max-height:150px; overflow-y:auto; font-size:0.9em; }
#vcAlert { margin-bottom:10px; font-weight:bold; display:none; font-size:1em; }
textarea { width:100%; height:60px; background:#0d1117; color:#e6edf3; border:1px solid #30363d; border-radius:6px; margin-top:10px; padding:6px; resize:none; }

button { background:#238636; color:#fff; border:none; border-radius:6px; padding:6px 12px; margin-top:6px; cursor:pointer; transition:0.2s; }
button:hover { background:#2ea043; }

#tabMarket, #tabScreenshot { background:#0d1117; border:1px solid #30363d; border-radius:6px 0 0 6px; padding:6px 12px; margin-top:10px; cursor:pointer; flex:1; text-align:center; }
#tabScreenshot { border-radius:0 6px 6px 0; margin-left:-1px; }
.tab-active { background:#30363d; color:#fff; }

#marketScreensInput, #uploadMarketScreensBtn, #clearMarketScreensBtn { display:none; }

@media(max-width:900px){
  .container{flex-direction:column; align-items:center;}
  header{justify-content:center; padding:10px;}
  .admin-controls{position:absolute; top:10px; right:10px; transform:none;}
  #mainPanel, .rightColumn{min-width:95%;}
}
</style>
</head>
<body>

<header>
  <h1>ZyG - Discord VC Attendance Live</h1>
  <div class="admin-controls">
    <span id="adminStatus" style="display:none; font-weight:bold; color:#2ea043;">Admin Logged In</span>
    <button id="adminBtn">Admin Login</button>
    <input type="password" id="adminPassword" placeholder="Password" style="display:none;">
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div class="container">
  <!-- MAIN PANEL -->
<!-- MAIN PANEL -->
<div class="panel" id="mainPanel">
  <h2>üì¢ Announcements</h2>
  <div id="announcementDisplay"></div>

  <!-- Admin-only controls -->
  <div id="announcementControls" style="display:none;">
    <textarea id="announcementInput" placeholder="Enter announcement..."></textarea>
    <button id="addAnnouncementBtn">Add</button>
    <button id="editAnnouncementBtn">Edit</button>
    <button id="updateAnnouncementBtn">Update</button>
    <button id="deleteAnnouncementBtn">Delete</button>
  </div>

  <div id="mainTabs">
    <div style="display:flex; gap:0; margin-top:20px;">
      <button id="tabMarket" class="tab-active">Next Market</button>
      <button id="tabScreenshot">Screenshot</button>
    </div>

    <div id="marketTab" style="margin-top:10px;">
      <input type="file" id="marketExcelInput" accept=".xlsx,.xls">
      <button id="importMarketBtn">Import Excel</button>
      <button id="clearMarketBtn">Clear Table</button>
      <table id="marketTable">
        <thead><tr><th>Date</th><th>Item</th><th>Price</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="screenshotTab" style="display:none; margin-top:10px;">
      <input type="file" id="marketScreensInput" multiple accept="image/*">
      <button id="uploadMarketScreensBtn">Upload Screenshot</button>
      <button id="clearMarketScreensBtn">Clear Screenshots</button>
      <div id="screenshotGallery" style="display:flex; gap:5px; flex-wrap:wrap; margin-top:10px;"></div>
    </div>
  </div>
</div>


  <!-- RIGHT COLUMN (unchanged) -->
  <div class="rightColumn">
    <div class="panel" id="vcPanel">
      <h2>üü¢ Live Voice Chat - Lordnine</h2>
      <div id="vcAlert"></div>
      <table id="active">
        <thead><tr><th>User</th><th>Channel</th><th>Status</th><th>Duration</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="panel" id="imagePanel" style="display:none;">
      <h2>üñºÔ∏è Upload image/screenshot for Attendance</h2>
      <input type="file" id="imageInput" multiple accept="image/*">
      <button id="uploadImagesBtn">Upload to Table</button>
      <table id="imageTable"><thead><tr><th>Preview</th><th>Filename</th><th>Status</th></tr></thead><tbody></tbody></table>
      <textarea id="imageMessage" placeholder="Optional message..."></textarea>
      <button id="sendImagesBtn">Send All to Discord</button>
      <button id="clearImageTableBtn">Clear Table</button>
      <button id="toggleHistoryBtn">Show Join/Leave History</button>
      <div id="notification" style="display:none;">‚úÖ Images sent!</div>
      <div id="history" style="display:none;"></div>

      <div id="adminSettings" style="margin-top:15px;">
        <h3>‚öôÔ∏è Admin Settings</h3>
        <div id="settingsDisplay">
          <p>Webhook URL: <span id="currentWebhook"></span></p>
          <p>Server ID: <span id="currentServer"></span></p>
          <p>Voice Channel ID: <span id="currentVoice"></span></p>
          <button id="editSettingsBtn">Edit</button>
          <button id="defaultSettingsBtn">Default</button>
        </div>
        <div id="settingsEdit" style="display:none;">
          <input type="text" id="webhookURL" placeholder="Webhook URL">
          <input type="text" id="serverID" placeholder="Server ID">
          <input type="text" id="voiceChannelID" placeholder="Voice Channel ID">
          <button id="saveSettingsBtn">Save</button>
          <button id="cancelEditBtn">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
// --- existing JS unchanged except mainPanel admin visibility ---
const socket = io();
let attendance = {};
const activeBody = document.querySelector("#active tbody");
const historyDiv = document.getElementById("history");
const vcAlert = document.getElementById("vcAlert");

function showVCAlert(msg,type){ vcAlert.textContent=msg; vcAlert.style.color=type==="join"?"#2ea043":"#da3633"; vcAlert.style.display="block"; setTimeout(()=>vcAlert.style.display="none",5000); }
function formatDuration(sec){ const h=Math.floor(sec/3600),m=Math.floor((sec%3600)/60),s=sec%60; return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`; }
function updateActive(){ activeBody.innerHTML=""; const now=new Date(); Object.entries(attendance.active||{}).forEach(([u,i])=>{ const joined=new Date(i.joinedAt||Date.now()); const dur=formatDuration(Math.floor((now-joined)/1000)); const mute=i.selfMute||i.serverMute?"üîá":"üé§"; const deaf=i.selfDeaf||i.serverDeaf?"üîï":"üëÇ"; const tr=document.createElement("tr"); tr.innerHTML=`<td>${u}</td><td>${i.channel||"Unknown"}</td><td>${mute} ${deaf}</td><td>${dur}</td>`; activeBody.appendChild(tr); }); }
function updateHistory(){ historyDiv.innerHTML=""; (attendance.history||[]).slice(0,20).forEach(h=>{ const d=document.createElement("div"); const t=new Date(h.time).toLocaleTimeString(); d.innerHTML=`<span class="${h.type==="join"?"joined":"left"}">${h.user}</span> ${h.type==="join"?"joined":"left"} <b>${h.channel}</b> at ${t}`; historyDiv.appendChild(d); }); }
setInterval(updateActive,1000);
socket.on("update",d=>{attendance=d;updateActive();updateHistory();});

// Admin login controls
const adminBtn=document.getElementById("adminBtn"),adminPassword=document.getElementById("adminPassword"),logoutBtn=document.getElementById("logoutBtn"),imagePanel=document.getElementById("imagePanel"),adminStatus=document.getElementById("adminStatus");
const mainPanel=document.getElementById("mainPanel"),mainTabs=document.getElementById("mainTabs");
let adminLoggedIn=localStorage.getItem("adminLoggedIn")==="true";
const announcementControls = document.getElementById("announcementControls");

// --- Admin login controls ---
const adminBtn = document.getElementById("adminBtn"),
      adminPassword = document.getElementById("adminPassword"),
      logoutBtn = document.getElementById("logoutBtn"),
      imagePanel = document.getElementById("imagePanel"),
      adminStatus = document.getElementById("adminStatus");

const mainTabs = document.getElementById("mainTabs");
const announcementControls = document.getElementById("announcementControls");

// Tabs admin-only buttons/inputs
const importMarketBtn = document.getElementById("importMarketBtn"),
      clearMarketBtn = document.getElementById("clearMarketBtn"),
      uploadMarketScreensBtn = document.getElementById("uploadMarketScreensBtn"),
      clearMarketScreensBtn = document.getElementById("clearMarketScreensBtn"),
      marketExcelInput = document.getElementById("marketExcelInput"),
      marketScreensInput = document.getElementById("marketScreensInput");

let adminLoggedIn = localStorage.getItem("adminLoggedIn") === "true";

function updateAdminUI() {
  // Admin login/logout visibility
  adminStatus.style.display = adminLoggedIn ? "inline-block" : "none";
  logoutBtn.style.display = adminLoggedIn ? "inline-block" : "none";
  adminBtn.style.display = adminLoggedIn ? "none" : "inline-block";
  adminPassword.style.display = adminLoggedIn ? "none" : "inline-block";

  // Image panel: admin only
  imagePanel.style.display = adminLoggedIn ? "block" : "none";

  // Tabs always visible
  mainTabs.style.display = "block";

  // Announcement controls: admin only
  announcementControls.style.display = adminLoggedIn ? "block" : "none";

  // Market/Screenshot tab buttons/inputs: admin only
  importMarketBtn.style.display = adminLoggedIn ? "inline-block" : "none";
  clearMarketBtn.style.display = adminLoggedIn ? "inline-block" : "none";
  uploadMarketScreensBtn.style.display = adminLoggedIn ? "inline-block" : "none";
  clearMarketScreensBtn.style.display = adminLoggedIn ? "inline-block" : "none";
  marketExcelInput.style.display = adminLoggedIn ? "inline-block" : "none";
  marketScreensInput.style.display = adminLoggedIn ? "inline-block" : "none";

  adminPassword.value = "";
}

// --- Event handlers ---
adminBtn.onclick = () => {
  adminPassword.style.display = "inline-block";
  adminPassword.focus();
};

adminPassword.onkeyup = e => {
  if (e.key === "Enter") {
    if (adminPassword.value === "0212") { // your password
      adminLoggedIn = true;
      localStorage.setItem("adminLoggedIn", "true");
      updateAdminUI();
      alert("Admin logged in!");
    } else {
      alert("Wrong password");
      adminPassword.value = "";
    }
  }
};

logoutBtn.onclick = () => {
  adminLoggedIn = false;
  localStorage.setItem("adminLoggedIn", "false");
  updateAdminUI();
  alert("Logged out!");
};

// Initial load
updateAdminUI();


// --- other JS (screenshots, settings, image panel, etc.) unchanged ---
// Tabs
const tabMarket=document.getElementById("tabMarket"),tabScreenshot=document.getElementById("tabScreenshot"),marketTab=document.getElementById("marketTab"),screenshotTab=document.getElementById("screenshotTab");
tabMarket.onclick=()=>{marketTab.style.display="block";screenshotTab.style.display="none";tabMarket.classList.add("tab-active");tabScreenshot.classList.remove("tab-active");};
tabScreenshot.onclick=()=>{marketTab.style.display="none";screenshotTab.style.display="block";tabMarket.classList.remove("tab-active");tabScreenshot.classList.add("tab-active");};

// Screenshots
let screenshots=JSON.parse(localStorage.getItem("screenshots")||"[]");
const screenshotGallery=document.getElementById("screenshotGallery");
function renderScreenshots(){screenshotGallery.innerHTML="";screenshots.forEach(img=>{const el=document.createElement("img");el.src=img;el.style.width="80px";el.style.height="80px";el.style.objectFit="cover";el.onclick=()=>window.open(img,"_blank");screenshotGallery.appendChild(el);});}
renderScreenshots();
document.getElementById("uploadMarketScreensBtn").onclick=()=>{const i=document.getElementById("marketScreensInput");Array.from(i.files).forEach(f=>{const r=new FileReader();r.onload=e=>{screenshots.push(e.target.result);localStorage.setItem("screenshots",JSON.stringify(screenshots));renderScreenshots();};r.readAsDataURL(f);});i.value="";};
document.getElementById("clearMarketScreensBtn").onclick=()=>{screenshots=[];localStorage.removeItem("screenshots");renderScreenshots();};

// Admin Settings
const defaults={webhookURL:"https://discord.com/api/webhooks/1433449406056763557/nifC_lCD78cMTOoMY6ryDBlain76udKiIEVOitIWT_n8XqygjGj_GWU0zDEf8v6GTxGu",serverID:"1038275000697901106",voiceChannelID:"1038275000697901110"};
const currentWebhook=document.getElementById("currentWebhook"),currentServer=document.getElementById("currentServer"),currentVoice=document.getElementById("currentVoice");
const editSettingsBtn=document.getElementById("editSettingsBtn"),defaultSettingsBtn=document.getElementById("defaultSettingsBtn"),saveSettingsBtn=document.getElementById("saveSettingsBtn"),cancelEditBtn=document.getElementById("cancelEditBtn");
const settingsDisplay=document.getElementById("settingsDisplay"),settingsEdit=document.getElementById("settingsEdit");
const webhookURLInput=document.getElementById("webhookURL"),serverIDInput=document.getElementById("serverID"),voiceChannelIDInput=document.getElementById("voiceChannelID");

function loadSettings(){
  const w=localStorage.getItem("webhookURL")||defaults.webhookURL;
  const s=localStorage.getItem("serverID")||defaults.serverID;
  const v=localStorage.getItem("voiceChannelID")||defaults.voiceChannelID;
  currentWebhook.textContent=w; currentServer.textContent=s; currentVoice.textContent=v;
  webhookURLInput.value=w; serverIDInput.value=s; voiceChannelIDInput.value=v;
}
editSettingsBtn.onclick=()=>{settingsDisplay.style.display="none";settingsEdit.style.display="block";};
cancelEditBtn.onclick=()=>{settingsDisplay.style.display="block";settingsEdit.style.display="none";};
saveSettingsBtn.onclick=()=>{localStorage.setItem("webhookURL",webhookURLInput.value);localStorage.setItem("serverID",serverIDInput.value);localStorage.setItem("voiceChannelID",voiceChannelIDInput.value);loadSettings();settingsDisplay.style.display="block";settingsEdit.style.display="none";alert("Settings saved!");};
defaultSettingsBtn.onclick=()=>{Object.entries(defaults).forEach(([k,v])=>localStorage.setItem(k,v));loadSettings();alert("Restored default settings!");};
loadSettings();

// Image Panel
const imageInput=document.getElementById("imageInput"),uploadImagesBtn=document.getElementById("uploadImagesBtn"),clearImageTableBtn=document.getElementById("clearImageTableBtn"),sendImagesBtn=document.getElementById("sendImagesBtn"),toggleHistoryBtn=document.getElementById("toggleHistoryBtn"),imageTableBody=document.querySelector("#imageTable tbody"),imageMessage=document.getElementById("imageMessage"),notification=document.getElementById("notification");
let imageFiles=[];
function renderImageTable(){imageTableBody.innerHTML="";imageFiles.forEach(f=>{const tr=document.createElement("tr");tr.innerHTML=`<td><img src="${f.data}" style="width:60px;height:60px;object-fit:cover;"></td><td>${f.name}</td><td>${f.status||"Pending"}</td>`;imageTableBody.appendChild(tr);});}
uploadImagesBtn.onclick=()=>{Array.from(imageInput.files).forEach(f=>{const r=new FileReader();r.onload=e=>{imageFiles.push({name:f.name,data:e.target.result,status:"Pending"});renderImageTable();};r.readAsDataURL(f);});imageInput.value="";};
clearImageTableBtn.onclick=()=>{imageFiles=[];renderImageTable();notification.style.display="none";};
toggleHistoryBtn.onclick=()=>{if(historyDiv.style.display==="none"){historyDiv.style.display="block";toggleHistoryBtn.textContent="Hide Join/Leave History";}else{historyDiv.style.display="none";toggleHistoryBtn.textContent="Show Join/Leave History";}};
sendImagesBtn.onclick=async()=>{const webhook=localStorage.getItem("webhookURL")||defaults.webhookURL;if(!webhook)return alert("Set webhook first!");if(imageFiles.length===0)return alert("No images.");sendImagesBtn.disabled=true;for(const f of imageFiles){try{const form=new FormData();form.append("file",dataURLtoBlob(f.data),f.name);if(imageMessage.value)form.append("content",imageMessage.value);await fetch(webhook,{method:"POST",body:form});f.status="Sent ‚úÖ";renderImageTable();}catch(err){f.status="Failed ‚ùå";renderImageTable();console.error(err);}}notification.style.display="block";setTimeout(()=>{imageFiles=[];renderImageTable();notification.style.display="none";},3000);sendImagesBtn.disabled=false;};
function dataURLtoBlob(d){const a=d.split(','),m=a[0].match(/:(.*?);/)[1],b=atob(a[1]),n=b.length,u8=new Uint8Array(n);for(let i=0;i<n;i++)u8[i]=b.charCodeAt(i);return new Blob([u8],{type:m});}

</script>
</body>
</html>
