<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZyG - Discord VC Attendance Live</title>
<style>
/* ------------------ GENERAL ------------------ */
body { 
  font-family: 'Segoe UI', sans-serif; 
  background:#0d1117; 
  color:#e6edf3; 
  margin:0; 
  padding:0; 
  display:flex; 
  flex-direction:column; 
  align-items:center; 
}
h1 { 
  color:#238636; 
  margin:20px 0; 
  text-align:center;
  word-break: break-word;
  flex:1;
}

/* ------------------ HEADER ------------------ */
header {
  width: 100%;
  display:flex;
  justify-content:center; 
  align-items:center;
  padding: 10px 20px;
  box-sizing: border-box;
  position: relative; 
}
.admin-controls {
  display:flex;
  align-items:center;
  gap:10px;
  position: absolute;
  right: 20px; 
  top: 50%;
  transform: translateY(-50%);
  flex-wrap: nowrap;
}
.admin-controls input, .admin-controls button {
  padding:6px 10px;
  border-radius:6px;
  border:none;
  font-size:0.9em;
}
.admin-controls input { border:1px solid #30363d; background:#0d1117; color:#e6edf3; }

/* ------------------ CONTAINER ------------------ */
.container { 
  display:flex; 
  gap:20px; 
  width:95%; 
  box-sizing:border-box;
  align-items: flex-start;
}

/* LEFT COLUMN */
#mainPanel { 
  flex: 2; 
  min-width: 400px;
}

/* RIGHT COLUMN */
.rightColumn {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 10px;
  min-width: 300px;
  position: relative;
}

/* ------------------ PANEL ------------------ */
.panel { 
  background:#161b22; 
  border:1px solid #30363d; 
  border-radius:12px; 
  padding:20px; 
  box-sizing:border-box;
}
table { width:100%; border-collapse:collapse; }
th,td { border-bottom:1px solid #30363d; padding:6px 10px; text-align:left; }
th { color:#238636; }
.joined { color:#2ea043; }
.left { color:#da3633; }
#history { max-height:150px; overflow-y:auto; font-size:0.9em; }
textarea { width:100%; height:60px; background:#0d1117; color:#e6edf3; border:1px solid #30363d; border-radius:6px; margin-top:10px; padding:6px; resize:none; }
button { 
  background:#238636; color:#fff; border:none; border-radius:6px; padding:6px 12px; margin-top:6px; cursor:pointer; 
  transition:0.2s; 
}
button:hover { background:#2ea043; }

/* --------- NextMarket & Screenshot Buttons --------- */
.tab-btn {
  background:#0d1117;
  border:1px solid #30363d;
  border-radius:6px 0 0 6px;
  color:#e6edf3;
  padding:6px 12px;
  cursor:pointer;
  margin-right:-4px; 
  transition:0.2s;
}
.tab-btn:last-child { border-radius:0 6px 6px 0; margin-right:0; }
.tab-btn.active { background:#444c56; color:#fff; }
.tab-btn:hover { background:#30363d; }

/* Highlight table when tab active */
.table-highlight { background:#2c313c; }

/* ------------------ RESPONSIVE ------------------ */
@media(max-width:900px){
  .container{flex-direction:column; align-items:center;}
  header{justify-content:center; padding:10px;}
  .admin-controls{position: absolute; top:10px; right:10px; transform:none; flex-wrap:wrap;}
  #mainPanel, .rightColumn{min-width:95%;}
}
</style>
</head>
<body>

<header>
  <h1>ZyG - Discord VC Attendance Live</h1>
  <div class="admin-controls">
    <span id="adminStatus" style="display:none; font-weight:bold; color:#2ea043;">Admin Logged In</span>
    <button id="adminBtn">Admin Login</button>
    <input type="password" id="adminPassword" placeholder="Password" style="display:none;">
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div class="container">

  <!-- LEFT: Main Panel -->
  <div class="panel" id="mainPanel">
    <h2>üì¢ Announcements</h2>
    <div id="announcementDisplay"></div>
    <textarea id="announcementInput" placeholder="Enter announcement..."></textarea>
    <button id="addAnnouncementBtn">Add</button>
    <button id="editAnnouncementBtn">Edit</button>
    <button id="updateAnnouncementBtn">Update</button>
    <button id="deleteAnnouncementBtn">Delete</button>

    <div style="display:flex; gap:0px; margin-top:20px;">
      <button class="tab-btn" id="tabMarket">Next Market</button>
      <button class="tab-btn" id="tabScreenshot">Screenshot</button>
    </div>

    <!-- MARKET TABLE -->
    <div id="marketTab" style="margin-top:10px;">
      <input type="file" id="marketExcelInput" accept=".xlsx,.xls">
      <button id="importMarketBtn">Import Excel</button>
      <button id="clearMarketBtn">Clear Table</button>
      <table id="marketTable">
        <thead><tr><th>Date</th><th>Item</th><th>Price</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- SCREENSHOT GALLERY -->
    <div id="screenshotTab" style="display:none; margin-top:10px;">
      <input type="file" id="marketScreensInput" multiple accept="image/*" style="display:none;">
      <button id="uploadMarketScreensBtn">Upload Screenshot</button>
      <button id="clearMarketScreensBtn">Clear Screenshots</button>
      <div id="screenshotGallery" style="display:flex; gap:5px; flex-wrap:wrap; margin-top:10px;"></div>
    </div>
  </div>

  <!-- RIGHT COLUMN: VC + Image stacked -->
  <div class="rightColumn">

    <!-- ACTIVE VC PANEL -->
    <div class="panel" id="vcPanel">
      <h2>üü¢ Live Voice Chat - Lordnine</h2>
      <div id="vcAlert"></div>
      <table id="active">
        <thead><tr><th>User</th><th>Channel</th><th>Status</th><th>Duration</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- IMAGE UPLOAD PANEL UNDER VC (ADMIN ONLY) -->
    <div class="panel" id="imagePanel" style="display:none;">
      <h2>üñºÔ∏è Upload image/screenshot for Attendance</h2>
      <input type="file" id="imageInput" multiple accept="image/*">
      <button onclick="uploadImages()">Upload to Table</button>
      <table id="imageTable">
        <thead><tr><th>Preview</th><th>Filename</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
      <textarea id="imageMessage" placeholder="Optional message to send with the images..."></textarea>
      <button onclick="sendImagesToDiscord()">Send All to Discord</button>
      <button onclick="clearImageTable()"> Clear Table</button>
      <button onclick="toggleHistoryPanel()"> Show Join/Leave History</button>
      <div id="notification">‚úÖ Images successfully uploaded! Clearing table...</div>
      <div id="history" style="display:none;"></div>

      <!-- -------- SETTINGS PANEL -------- -->
      <div id="settingsPanel" style="margin-top:20px; display:block;">
        <h3>‚öôÔ∏è Admin Settings</h3>
        <label>New Webhook URL:</label>
        <input type="text" id="newWebhook" placeholder="Enter new webhook URL" style="width:100%; margin-bottom:6px;">
        <label>New Voice Channel ID:</label>
        <input type="text" id="newVoiceChannel" placeholder="Enter new voice channel ID" style="width:100%; margin-bottom:6px;">
        <label>New Server ID:</label>
        <input type="text" id="newServer" placeholder="Enter new server ID" style="width:100%; margin-bottom:6px;">
        <button id="saveSettingsBtn">Save</button>
        <button id="defaultSettingsBtn">Default</button>
      </div>

    </div>

  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
// --- ADMIN LOGIN LOGIC ---
const adminBtn = document.getElementById('adminBtn');
const logoutBtn = document.getElementById('logoutBtn');
const adminStatus = document.getElementById('adminStatus');
const imagePanel = document.getElementById('imagePanel');
const marketScreensInput = document.getElementById('marketScreensInput');

let isAdmin = false;

adminBtn.addEventListener('click', ()=>{
    let pwd = prompt("Enter admin password:");
    if(pwd==="admin123"){
        isAdmin = true;
        adminStatus.style.display='inline';
        logoutBtn.style.display='inline';
        adminBtn.style.display='none';
        imagePanel.style.display='block';
        marketScreensInput.style.display='inline-block';
    }
});

logoutBtn.addEventListener('click', ()=>{
    isAdmin = false;
    adminStatus.style.display='none';
    logoutBtn.style.display='none';
    adminBtn.style.display='inline-block';
    imagePanel.style.display='none';
    marketScreensInput.style.display='none';
});

// --- TAB BUTTONS ---
const tabMarketBtn = document.getElementById('tabMarket');
const tabScreenshotBtn = document.getElementById('tabScreenshot');
const marketTabDiv = document.getElementById('marketTab');
const screenshotTabDiv = document.getElementById('screenshotTab');
const marketTable = document.getElementById('marketTable');
const screenshotGallery = document.getElementById('screenshotGallery');

tabMarketBtn.addEventListener('click', ()=>{
    tabMarketBtn.classList.add('active');
    tabScreenshotBtn.classList.remove('active');
    marketTabDiv.style.display='block';
    screenshotTabDiv.style.display='none';
    marketTable.classList.add('table-highlight');
    screenshotGallery.classList.remove('table-highlight');
});

tabScreenshotBtn.addEventListener('click', ()=>{
    tabMarketBtn.classList.remove('active');
    tabScreenshotBtn.classList.add('active');
    marketTabDiv.style.display='none';
    screenshotTabDiv.style.display='block';
    marketTable.classList.remove('table-highlight');
    screenshotGallery.classList.add('table-highlight');
});

// --- SETTINGS PANEL LOGIC ---
const saveSettingsBtn = document.getElementById('saveSettingsBtn');
const defaultSettingsBtn = document.getElementById('defaultSettingsBtn');

let defaultSettings = {
    webhook: "YOUR_DEFAULT_WEBHOOK",
    voiceChannelId: "DEFAULT_VOICE_CHANNEL",
    serverId: "DEFAULT_SERVER_ID"
};
let currentSettings = {...defaultSettings};

saveSettingsBtn.addEventListener('click', ()=>{
    currentSettings.webhook = document.getElementById('newWebhook').value || defaultSettings.webhook;
    currentSettings.voiceChannelId = document.getElementById('newVoiceChannel').value || defaultSettings.voiceChannelId;
    currentSettings.serverId = document.getElementById('newServer').value || defaultSettings.serverId;
    alert("Settings saved!");
});

defaultSettingsBtn.addEventListener('click', ()=>{
    currentSettings = {...defaultSettings};
    document.getElementById('newWebhook').value = defaultSettings.webhook;
    document.getElementById('newVoiceChannel').value = defaultSettings.voiceChannelId;
    document.getElementById('newServer').value = defaultSettings.serverId;
    alert("Settings reverted to default!");
});

// --- SEND IMAGES TO DISCORD ---
async function sendImagesToDiscord(){
    let webhookToUse = currentSettings.webhook;
    const files = document.getElementById('imageInput').files;
    const message = document.getElementById('imageMessage').value;

    if(files.length === 0){
        alert("No images selected!");
        return;
    }

    for(let i = 0; i < files.length; i++){
        const file = files[i];
        const formData = new FormData();
        formData.append('file', file);
        if(message) formData.append('content', message);

        try {
            await fetch(webhookToUse, { method:'POST', body: formData });
            console.log(`Sent ${file.name} successfully.`);
        } catch(err){
            console.error(`Error sending ${file.name}:`, err);
        }
    }

    alert("All images sent!");
    clearImageTable();
}

// Placeholder functions
function uploadImages(){alert("Upload Images placeholder");}
function clearImageTable(){document.getElementById('imageTable').querySelector('tbody').innerHTML='';}
function toggleHistoryPanel(){ const h=document.getElementById('history'); h.style.display=h.style.display==='none'?'block':'none'; }

</script>
</body>
</html>
